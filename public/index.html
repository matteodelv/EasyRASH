<!DOCTYPE html>
<html>

<head>
   <meta charset="utf-8" />
   <link href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
   <script src="//code.jquery.com/jquery-2.2.3.min.js" integrity="sha256-a23g1Nt4dtEYOj7bR+vTu7+T8VP13humZFBJNIYoEJo=" crossorigin="anonymous"></script>
   <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
   <script src="js/bootstrap-notify.min.js"></script>
   <link rel="stylesheet" type="text/css" href="stylesheets/style.css">
   <link rel="stylesheet" type="text/css" href="stylesheets/animate.css">
   <script type="text/javascript">
   if (localStorage.accessToken) {
      $.ajax({
         url: '/api/verify',
         type: 'POST',
         data: {
            access_token: "Bearer " + localStorage.accessToken
         },
         success: function(result) {
            localStorage.accessToken = result.access_token;
         },
         error: function(result) {
            $(window).load(function() {
               $('#login-modal').modal('show');
            });
         }
      });
   } else {
      $(window).load(function() {
         $('#login-modal').modal('show');
      });
   }
   </script>
   <title>Homepage</title>
</head>

<body>
   <div class="container-fluid">
      <h1>Welcome to a static file</h1>
      <ul>
         <li>
            You can find papers at /api/papers/:id <a href="/api/papers/ciancarini-eswc2014">(example here)</a>
         </li>
         <li>
            Authenticate at /api/authenticate with a POST request (email and password)
         </li>
      </ul>
   </div>
   <div class="modal fade" id="login-modal" tabindex="-1" role="dialog" aria-labelledby="login dialog" aria-hidden="true">
      <div class="modal-dialog">
         <div class="modal-content">
            <!-- Modal Header -->
            <div class="modal-header">
               <button type="button" class="close" data-dismiss="modal">
                  <span aria-hidden="true">&times;</span>
                  <span class="sr-only">Close</span>
               </button>
               <h4 class="modal-title" id="myModalLabel">Please login</h4>
            </div>
            <!-- Modal Body -->
            <div class="modal-body">
               <form role="form" id="loginpanel" action="javascript:auth()">
                  <div class="form-group">
                     <label for="email">Email address</label>
                     <input type="text" class="form-control" id="email" name="email" value="" placeholder="Email">
                  </div>
                  <div class="form-group">
                     <label for="password">Password</label>
                     <input type="password" class="form-control" id="password" name="password" value="" placeholder="Password">
                  </div>
               </form>
            </div>
            <!-- Modal Footer -->
            <div class="modal-footer">
               <span class="help-inline error"></span>
               <button type="submit" id="loginbutton" class="btn btn-primary" name="commit" value="Login">Login</button>
            </div>
         </div>
      </div>
</body>
<script>
function auth() {
   $.ajax({
      url: '/api/authenticate',
      type: 'POST',
      data: {
         email: $('#email').val(),
         password: $('#password').val()
      },
      success: function(result) {
         localStorage.accessToken = result.access_token;
         $('#login-modal').modal('hide');
         $.notify({ //http://bootstrap-notify.remabledesigns.com/
            message: 'Welcome ' + result.id
         }, {
            type: 'success',
            delay: 2000
         });
      },
      error: function(result) {
         $('#loginbutton').prev('.help-inline').text(JSON.parse(result.responseText).message);
      }
   });
}

$("#email, #password").keyup(function(event) {
   if (event.keyCode == 13) {
      auth();
   }
});
$('#loginbutton').click(function() {
   auth();
});
</script>

</html>
